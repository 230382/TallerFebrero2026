---
- hosts: linux 
  become: true 
  
  tasks: 

  - name: update all installed packages in CentOD
    ansible.builtin.dnf: 
      name: "*" 
      state: latest 
    notify: Reboot servers 
    when: ansible_os_family == "RedHat" 

  - name: Update all installed packages in Ubuntu
    ansible.builtin.apt:
      name: "*"
      state: latest
      update_cache: true 
    notify: Reboot servers 
    when: ansible_os_family == "Debian"     

  - name: Deshabilitar login root por SSH Ubuntu
    ansible.builtin.lineinfile:
      path: /etc/ssh/sshd_config
      regexp: '^#?PermitRootLogin'
      line: 'PermitRootLogin no'
      state: present
      backup: yes
    notify: Reiniciar ssh Ubuntu 

  - name: Deshabilitar login root por SSH Centos 
    ansible.builtin.lineinfile:
      path: /etc/ssh/sshd_config
      regexp: '^#?PermitRootLogin'
      line: 'PermitRootLogin no'
      state: present
      backup: yes
    notify: Reiniciar ssh Centos


  handlers:  
        
  - name: Reboot Servers 
    ansible.builtin.reboot: 
   
  - name: Reiniciar ssh Ubuntu
    ansible.builtin.service:
      name: ssh
      state: restarted  
 

  - name: Reiniciar ssh Centos 
    ansible.builtin.service:
      name: sshd
      state: restarted


        
